syntax = "proto3";

package mentor.client.chat;

import "mentor/types/chat.proto";
import "mentor/types/common.proto";

// --- Chat Threads (Sessions) ---

message ListChatsRequest {
  mentor.types.PageRequest pagination = 1;

  // Filter
  uint32 bot_id = 2; // Optional: List chats for specific bot
  
  bool only_pinned = 3;
  bool is_archived = 4; // Use false for active chats
}

message ListChatsResponse {
  repeated mentor.types.chat.ChatThread threads = 1;
  mentor.types.PageResponse pagination = 2;
}

message UpdateChatThreadRequest {
  uint32 thread_id = 1;
  
  // Fields to update (if provided)
  string title = 2; // Rename
  mentor.types.chat.ChatMode response_mode = 3;
  bool sinking_mode_enabled = 4;
}

message DeleteChatThreadRequest {
  uint32 thread_id = 1;
}

message DeleteChatThreadResponse {
  bool success = 1;
}

message ArchiveChatRequest {
  uint32 thread_id = 1;
  bool archived = 2; // true = archive, false = unarchive
}

message PinChatRequest {
  uint32 thread_id = 1;
  bool pinned = 2; // true = pin, false = unpin
}

message ReorderPinnedChatsRequest {
  repeated uint32 thread_ids = 1; // New order
}

// --- Messages ---

message GetHistoryRequest {
  uint32 thread_id = 1;
  mentor.types.PageRequest pagination = 2;
  
  // Filters
  bool only_favorites = 3;
}

message GetHistoryResponse {
  repeated mentor.types.chat.Message messages = 1;
  mentor.types.PageResponse pagination = 2;
}

message SendMessageRequest {
  uint32 thread_id = 1;
  
  oneof content {
    string text = 2;
    string audio_url = 3;
    string image_url = 4;
    // Or just reusing Message structure but simpler
  }
  
  // Client generated ID for idempotency?
  string local_id = 5; 
}

message ToggleMessageFavoriteRequest {
  string message_id = 1;
}

message ToggleMessageFavoriteResponse {
  bool is_favorite = 1;
}

message SubscribeToEventsRequest {
  uint32 thread_id = 1;
}

service ChatService {
  // Session Management
  rpc ListChats(ListChatsRequest) returns (ListChatsResponse);
  rpc UpdateChatThread(UpdateChatThreadRequest) returns (mentor.types.chat.ChatThread);
  rpc DeleteChatThread(DeleteChatThreadRequest) returns (DeleteChatThreadResponse);
  
  rpc ArchiveChat(ArchiveChatRequest) returns (mentor.types.chat.ChatThread);
  rpc PinChat(PinChatRequest) returns (mentor.types.chat.ChatThread);
  rpc ReorderPinnedChats(ReorderPinnedChatsRequest) returns (ListChatsResponse);

  // Messaging
  rpc GetHistory(GetHistoryRequest) returns (GetHistoryResponse);
  rpc SendMessage(SendMessageRequest) returns (mentor.types.chat.Message);
  rpc ToggleMessageFavorite(ToggleMessageFavoriteRequest) returns (ToggleMessageFavoriteResponse);

  // Real-time Stream
  rpc SubscribeToEvents(SubscribeToEventsRequest) returns (stream mentor.types.chat.ChatEvent);
}
