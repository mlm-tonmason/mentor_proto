syntax = "proto3";

package mentor.client.market;

import "google/protobuf/empty.proto";
import "mentor/types/bot.proto";
import "mentor/types/common.proto";

// Сервис каталога и витрины ботов.
service MarketService {
    // --- Каталог и Поиск ---

    // Получить детальную информацию о боте.
    rpc GetBot(mentor.types.bot.Bot.Id) returns (mentor.types.bot.Bot);

    // Получить список ботов с фильтрацией и поиском.
    // Используется для главной страницы, каталога и поисковой строки.
    // Возвращает полный список подходящих ботов (без пагинации).
    rpc SearchBots(SearchBotsRequest) returns (mentor.types.bot.Bot.List);

    // --- Социальное взаимодействие ---

    // Оценить бота (поставить рейтинг).
    rpc RateBot(mentor.types.Rating.RateRequest) returns (mentor.types.Rating);

    // Добавить бота в избранное.
    rpc AddToFavorites(mentor.types.bot.Bot.Id) returns (google.protobuf.Empty);

    // Удалить бота из избранного.
    rpc RemoveFromFavorites(mentor.types.bot.Bot.Id) returns (google.protobuf.Empty);

    // --- Библиотека пользователя ---

    // Получить "Мою библиотеку" (Купленные + Избранные + Недавние).
    // Возвращает список ботов, с которыми пользователь взаимодействовал:
    // 1. Приобретенные (активная или архивная подписка).
    // 2. Добавленные в избранное.
    // 3. Недавно использованные (History).
    rpc ListMyLibrary(google.protobuf.Empty) returns (mentor.types.bot.Bot.List);
}

// --- Запросы и Ответы ---

message SearchBotsRequest {
    // ID создателя (если 0, то не фильтровать).
    uint32 creator_id = 1;

    // Рейтинг.
    fixed32 min_rating = 2;
    
    // Текстовый поиск (по имени, описанию, тегам).
    string prefix_system_name = 3;

    // Фильтр по жанру.
    repeated mentor.types.bot.Bot.Genre.Id genre_ids = 4;

    // Фильтр по категории (строковый тег).
    repeated string category_tags = 5;

    // Флаги фильтрации.
    bool is_hot = 6;      // Трендовый.
    bool is_favorite = 7; // В избранном (контекстно).
    bool is_subscribed = 8; // Есть активная подписка (контекстно).
    
    // Пагинация.
    mentor.types.Cursor cursor = 9;
}
