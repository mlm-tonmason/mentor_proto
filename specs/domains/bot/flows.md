# Процессы Бота (Bot Flows)

## 1. Каталог и Библиотека (Marketplace)

### 1.5 Оценка и Рейтинг (Rating)
* **Метод**: `RateBot(botId, score=1..5)`.
* **Логика**:
    * Пользователь может выставить оценку боту, которым пользовался.
    * Повторная отправка обновляет существующую оценку.
    * Оценка пересчитывает средний рейтинг (`Bot.stats.rating.average`).

### 1.1 Просмотр списка (Workshop) (Вкладки)
* **Разделение на вкладки**:
    1.  `Experts`: Экспертные боты от Компании (`classification.genre = EXPERT`).
    2.  `Twins`: Двойники, созданные пользователями (`classification.genre = TWIN`).
* **Поиск и Фильтрация**:
    * **Поиск по имени**: Отсутствует.
    * **Фильтры (`sort` enum)**:
        * `NEWEST`: Сначала новые.
        * `POPULAR`: Популярные (по кол-ву подписчиков).
        * `TOP_RATED`: Лучшие (по рейтингу 5.0 -> 1.0).
    * **Фильтры (checkbox)**:
        * `category`: По жанру/тегу.
        * `isHot`: Трендовые.
        * `isFavorite`: Избранные текущим пользователем.
        * `isSubscribed`: На кого уже есть подписка.
* **Карточка**: Отображает `shortDescription`, цену "от $X/месяц", бейджи, **звездочки рейтинга**.

### 1.2 Моя Библиотека (My Library) / Dashboard
* **Основной экран**: Список ботов с активной подпиской.
* **Empty State (Если пусто)**:
    * Пользователь видит экран-заглушку с текстом "У вас пока нет активных ботов".
    * Большая кнопка **"Перейти в Каталог"**.
* **Фильтры**:
    * `Favorites`: Звездочка.
    * `Recent`: Недавние.

### 1.3 Избранное (Favorites)
* **Метод**: `ToggleBotFavorite(botId)`.
* **Логика**:
    * Если бот уже в избранном -> Удалить.
    * Если нет -> Добавить.
* **Применение**: Можно добавить любого бота (из Каталога или Библиотеки). Работает как глобальный фильтр.

### 1.4 Карточка Бота (Product Page)
* **Информация**:
    * `Author`: Кто создал (Компания или Юзер).
    * `LongDescription`: Полное описание.
* **Тарифы**:
    * Список всех `PricingPlans`, включающих этого бота (Показать карточки тарифов).
* **Ограничения**:
    * **Messaging**: Писать боту до покупки запрещено.
    * **Trial**: Пробного периода нет.

## 2. Управление Ботами (Admin)

### 2.2 Управление Ботами (UGC & Admin)
* **Создание (UGC)**:
    * Любой пользователь может создать черновик (`isPrivate=true`).
    * **Публикация**: Пользователь отправляет запрос на публикацию (`RequestVerification`).
    * **Модерация**: Админ одобряет/отклоняет. После одобрения бот попадает в общий каталог.
* **Обновление (Versioning)**:
    * При изменении системных файлов бота (`systemPrompt`, `knowledgeBase`) инкрементируется `version`.
    * **Стратегия (4.2C)**: Активные диалоги продолжаются без разрывов. LLM получает новые инструкции "на лету" в следующем сообщении. Специальной миграции базы сообщений не требуется.

### 2.3 Настройки Голоса
* Привязка доступных `voiceId` к боту.
* Выбор `defaultVoiceId`.
