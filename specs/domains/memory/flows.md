# Процессы Памяти (Memory Flows)

## 1. Память Аватара и Настройки (Avatar Memory)

### 1.1 Общая Память (Shared Context)
Система работает с двумя типами памяти:
1.  **AvatarUserMemory**: Структурированные "факты" о человеке (заполняет LLM).
2.  **AvatarUserKVMemory**: Плоские настройки (заполняет Клиент/Бот).
    *   Ключи автоматически попадают в System Prompt с префиксом (например, `USER_THEME=Dark`).

### 1.2 Сброс памяти
* **Сброс памяти бота**:
    * Действие: Удаляет `UserProfileInstance` и `Summary` для данного бота.
    * Результат: Бот "забывает" пользователя, общение начинается с чистого листа.

## 2. Просмотр Профиля (Memory View)

### 2.1 Просмотр
* Пользователь может видеть, что бот "знает" о нем:
    * Просмотр `UserProfileInstance` (поля и значения, заполненные ботом).
    * Просмотр цепочки `DialogueSummary` (краткое содержание прошлых бесед).

## 3. Управление Шаблонами Профилей (Admin)

### 3.1 Шаблоны (Templates)
* Создание и редактирование шаблонов опросников (например, "Crypto Investor Template", "Psychology Patient Template").
* Определение структуры полей/вопросов, которые бот должен стремиться "выяснить" и заполнить о пользователе в ходе диалога.

### 3.2 Версионирование
* Поддержка версий шаблонов (`UserProfileTemplateVersion`).
* Возможность обновлять шаблон без поломки существующих профилей (старые профили используют старую версию схемы, новые - новую).

### 3.3 Привязка (Binding)
* `BotUserProfileBinding`: Указание, какой шаблон использует конкретный бот.
* Это позволяет ботам одной категории (например, разным крипто-экспертам) использовать единую структуру памяти о пользователе.
