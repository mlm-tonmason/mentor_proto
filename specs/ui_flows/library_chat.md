# –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏ –ß–∞—Ç (Library & Active Chat)

## 1. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ß–∞—Ç–∞ (Split View)
–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞ —Å –±–æ—Ç–æ–º, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω–∞—è –Ω–∞ —Å–ø–∏—Å–æ–∫ (Sidebar) –∏ —Å–∞–º —á–∞—Ç.

![Chat Screen](./assets/chat_in_library.png)

### –ë–ª–æ–∫: Sidebar (–°–ø–∏—Å–æ–∫ –ë–æ—Ç–æ–≤ –∏ –î–∏–∞–ª–æ–≥–æ–≤)
* **API –ú–µ—Ç–æ–¥**: `ChatService/GetBotList(pagination)`.
* **–ú–æ–¥–µ–ª—å**: `ChatThread` (–ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è).
* **–õ–æ–≥–∏–∫–∞ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è**:
    1.  **Pinning (–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ)**:
        *   **–ò–∫–æ–Ω–∫–∞**: –°–∫—Ä–µ–ø–∫–∞ (üìå).
        *   **–î–µ–π—Å—Ç–≤–∏–µ**: `ChatService/PinChat(threadId)` / `UnpinChat`.
        *   **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (Drag & Drop)**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ–º (`ChatService/ReorderPinnedChats`).
    2.  **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞**:
        *   **Pinned Chats**: –í—Å–µ–≥–¥–∞ —Å–≤–µ—Ä—Ö—É.
        *   **Recent Chats**: –û—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ (`lastMessageAt`).
    3.  **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**:
        *   `Unread Count` (–µ—Å–ª–∏ –µ—Å—Ç—å).
        *   `Status`: Typing... (—á–µ—Ä–µ–∑ Stream).

### –ë–ª–æ–∫: –û–∫–Ω–æ –ß–∞—Ç–∞ (Messages Area)
* **API –ú–µ—Ç–æ–¥**: `ChatService/GetHistory(threadId, filter=ALL|FAVORITES)`.
* **–ú–æ–¥–µ–ª—å**: `Message`.
* **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
    1.  **–ò–∑–±—Ä–∞–Ω–Ω—ã–µ –°–æ–æ–±—â–µ–Ω–∏—è (Favorites)**:
        *   **–î–µ–π—Å—Ç–≤–∏–µ**: –ö–ª–∏–∫ –Ω–∞ `Star` (‚≠ê) —É —Å–æ–æ–±—â–µ–Ω–∏—è -> `ChatService/ToggleMessageFavorite`.
        *   **–ü–æ–∏—Å–∫/–§–∏–ª—å—Ç—Ä**: –ö–Ω–æ–ø–∫–∞ "Show only Favorites" –≤ —Ö–µ–¥–µ—Ä–µ —á–∞—Ç–∞ -> –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Å `filter=FAVORITES`.
        *   **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ**: –¢–æ–ª—å–∫–æ "–∑–≤–µ–∑–¥–Ω—ã–µ" —Å–æ–æ–±—â–µ–Ω–∏—è (—Ü–∏—Ç–∞—Ç–Ω–∏–∫).
    2.  **–ö–æ–Ω—Ç–µ–Ω—Ç**:
        *   –¢–µ–∫—Å—Ç, –ê—É–¥–∏–æ (–ø–ª–µ–µ—Ä + —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è), –ö–∞—Ä—Ç–∏–Ω–∫–∏.
        *   **Sinking Mode**: –ê–Ω–∏–º–∞—Ü–∏—è "Thinking..." –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º.

### –ë–ª–æ–∫: Input (–í–≤–æ–¥)
* **Modes**: Text / Voice (Hold-to-Record).
### –ë–ª–æ–∫: –†–µ–∂–∏–º –û—Ç–≤–µ—Ç–∞ (Response Mode Widget)

![Response Mode Widget](./assets/chat_response_mode.png)

* **–õ–æ–∫–∞—Ü–∏—è**: –†—è–¥–æ–º —Å –ø–æ–ª–µ–º –≤–≤–æ–¥–∞ (—Å–ª–µ–≤–∞/—Å–ø—Ä–∞–≤–∞) –∏–ª–∏ –≤ —Ö–µ–¥–µ—Ä–µ.
* **API –ú–µ—Ç–æ–¥**: `UpdateChatSettings({ responseMode: "VOICE" })`.
* **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
    *   **–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å (Toggle/Select)**:
        *   **Text (–¢–µ–∫—Å—Ç)**: –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.
        *   **Voice (–ì–æ–ª–æ—Å)**: –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º (–∞—É–¥–∏–æ + —Ç–µ–∫—Å—Ç).
    *   **–ò–Ω–¥–∏–∫–∞—Ü–∏—è**:
        *   –ò–∫–æ–Ω–∫–∞ (üìù vs üéôÔ∏è).
        *   –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è.
    *   **–í–ª–∏—è–Ω–∏–µ**: –ù–µ –º–µ–Ω—è–µ—Ç —Å–ø–æ—Å–æ–± –≤–≤–æ–¥–∞ —é–∑–µ—Ä–∞ (–≤—ã –º–æ–∂–µ—Ç–µ –≥–æ–≤–æ—Ä–∏—Ç—å –≥–æ–ª–æ—Å–æ–º, –∞ –±–æ—Ç –æ—Ç–≤–µ—á–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–º), –º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ *—Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞*.

### –ë–ª–æ–∫: –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –ú–µ–Ω—é –ß–∞—Ç–∞ (Chat Actions)

![Chat Actions Menu](./assets/chat_menu_actions.png)

* **–õ–æ–∫–∞—Ü–∏—è**: –ö–Ω–æ–ø–∫–∞ **"—Ç—Ä–∏ —Ç–æ—á–∫–∏" (...)** –∏–ª–∏ **"—à–µ—Å—Ç–µ—Ä–µ–Ω–∫–∞"** –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ —á–∞—Ç–∞.
* **API –ú–µ—Ç–æ–¥**: –ú–µ—Ç–æ–¥—ã —Å–µ—Ä–≤–∏—Å–∞ `ChatService`.
* **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
    1.  **–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å (Rename)**:
        *   **–î–µ–π—Å—Ç–≤–∏–µ**: –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–æ–ª–µ–º –≤–≤–æ–¥–∞.
        *   **API**: `UpdateChatThread({ title: "My New Title" })`.
        *   **UX**: –ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Å–∞–π–¥–±–∞—Ä–µ.
        *   *–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é*: –ß–∞—Ç –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ –ø–µ—Ä–≤–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é (Auto-generated), –Ω–æ —é–∑–µ—Ä –º–æ–∂–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å.
    2.  **–ê—Ä—Ö–≤–∏—Ä–æ–≤–∞—Ç—å (Archive)**:
        *   **–î–µ–π—Å—Ç–≤–∏–µ**: –£–±–∏—Ä–∞–µ—Ç —á–∞—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö.
        *   **API**: `ArchiveChat(threadId)`.
    3.  **–£–¥–∞–ª–∏—Ç—å (Delete)**:
        *   **–î–µ–π—Å—Ç–≤–∏–µ**: –£–¥–∞–ª—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –Ω–∞–≤—Å–µ–≥–¥–∞.
        *   **UI**: **–ö—Ä–∞—Å–Ω–∞—è –∫–Ω–æ–ø–∫–∞** + Confirm Modal ("–í—ã —É–≤–µ—Ä–µ–Ω—ã?").
        *   **API**: `DeleteChatThread(threadId)`.
